<!DOCTYPE html>
<html lang="vi">
<head:
  <meta charset="UTF-8">
  <title>Halloween Click Game ğŸƒ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Halloween Clicker ğŸƒğŸ‘»</h1>
    <div class="subtitle">Click bÃ­ ngÃ´ Ä‘á»ƒ + Ä‘iá»ƒm, trÃ¡nh báº¥m nháº§m ma nha!</div>

    <div class="status-bar">
      <div class="status-item">
        Äiá»ƒm: <span id="score">0</span>
      </div>
      <div class="status-item">
        Thá»i gian: <span id="time">30</span>s
      </div>
    </div>

    <div id="message"></div>

    <div id="gameArea"></div>

    <div class="player-row">
      <input
        type="text"
        id="playerName"
        placeholder="Nháº­p tÃªn ngÆ°á»i chÆ¡i..."
      >
    </div>

    <div class="controls">
      <button id="startBtn">Báº¯t Ä‘áº§u chÆ¡i</button>
    </div>

    <div class="tip">
      ğŸ¯ BÃ­ ngÃ´: <span class="highlight">+10 Ä‘iá»ƒm</span> â€¢ ğŸ‘» Ma: <span class="highlight">-5 Ä‘iá»ƒm</span> â€¢ Thá»i gian: <span class="highlight">30s</span>
    </div>

    <div class="leaderboard">
      <div class="lb-title">ğŸ† Báº£ng xáº¿p háº¡ng</div>
      <ol id="leaderboardList"></ol>
    </div>
  </div>

  <script>
    const gameArea = document.getElementById("gameArea");
    const scoreEl = document.getElementById("score");
    const timeEl = document.getElementById("time");
    const messageEl = document.getElementById("message");
    const startBtn = document.getElementById("startBtn");
    const playerNameInput = document.getElementById("playerName");
    const leaderboardList = document.getElementById("leaderboardList");

    let score = 0;
    let timeLeft = 30;
    let gameInterval = null;
    let spawnInterval = null;
    let isPlaying = false;
    let currentPlayerName = "";

    // Load leaderboard tá»« localStorage
    let leaderboard = [];
    try {
      leaderboard = JSON.parse(localStorage.getItem("halloween_leaderboard") || "[]");
    } catch (e) {
      leaderboard = [];
    }

    function saveLeaderboard() {
      localStorage.setItem("halloween_leaderboard", JSON.stringify(leaderboard));
    }

    function renderLeaderboard() {
      leaderboardList.innerHTML = "";

      if (!leaderboard.length) {
        const li = document.createElement("li");
        li.textContent = "ChÆ°a cÃ³ ai chÆ¡i...";
        leaderboardList.appendChild(li);
        return;
      }

      leaderboard.forEach((entry, index) => {
        const li = document.createElement("li");
        li.textContent = `${index + 1}. ${entry.name} - ${entry.score} Ä‘iá»ƒm`;
        leaderboardList.appendChild(li);
      });
    }

    renderLeaderboard();

    function resetGame() {
      score = 0;
      timeLeft = 30;
      scoreEl.textContent = score;
      timeEl.textContent = timeLeft;
      messageEl.textContent = "";
      gameArea.innerHTML = "";
    }

    function updateLeaderboard() {
      if (score <= 0) return; // Ä‘iá»ƒm Ã¢m/0 thÃ¬ khá»i vÃ o báº£ng

      const name = currentPlayerName || "NgÆ°á»i chÆ¡i áº©n danh";

      leaderboard.push({ name, score });
      leaderboard.sort((a, b) => b.score - a.score);
      leaderboard = leaderboard.slice(0, 5); // giá»¯ top 5
      saveLeaderboard();
      renderLeaderboard();
    }

    function endGame() {
      isPlaying = false;
      clearInterval(gameInterval);
      clearInterval(spawnInterval);

      gameArea.innerHTML = "";

      if (score >= 150) {
        messageEl.textContent = "Äá»‰nh luÃ´n! Báº¡n lÃ  trÃ¹m sÄƒn bÃ­ Ä‘Ãªm Halloween! ğŸ”¥";
      } else if (score >= 80) {
        messageEl.textContent = "KhÃ¡ pháº¿t Ä‘Ã³, Halloween nÃ y cÃ³ káº¹o rá»“i! ğŸ¬";
      } else if (score > 0) {
        messageEl.textContent = "CÅ©ng táº¡m, luyá»‡n thÃªm vÃ i vÃ¡n ná»¯a nha! ğŸ˜¼";
      } else {
        messageEl.textContent = "ThÃ´i xong... ma nÃ³ cÆ°á»i báº¡n kÃ¬a ğŸ˜­";
      }

      updateLeaderboard();

      startBtn.textContent = "ChÆ¡i láº¡i";
    }

    function spawnEntity() {
      if (!isPlaying) return;

      const entity = document.createElement("div");
      entity.classList.add("entity");

      const isPumpkin = Math.random() < 0.65;

      if (isPumpkin) {
        entity.classList.add("pumpkin");
        entity.textContent = "ğŸƒ";
      } else {
        entity.classList.add("ghost");
        entity.textContent = "ğŸ‘»";
      }

      const areaRect = gameArea.getBoundingClientRect();
      const size = 50;
      const maxX = areaRect.width - size - 8;
      const maxY = areaRect.height - size - 8;
      const x = Math.random() * maxX + 4;
      const y = Math.random() * maxY + 4;

      entity.style.left = x + "px";
      entity.style.top = y + "px";

      entity.addEventListener("click", (e) => {
        if (!isPlaying) return;
        e.stopPropagation();

        if (entity.classList.contains("pumpkin")) {
          score += 10;
          messageEl.textContent = "Nice! +10 Ä‘iá»ƒm tá»« bÃ­ ngÃ´ ğŸƒ";
        } else {
          score -= 5;
          messageEl.textContent = "áº¤y da... báº¥m nháº§m ma rá»“i, -5 Ä‘iá»ƒm ğŸ‘»";
        }

        scoreEl.textContent = score;
        entity.remove();
      });

      setTimeout(() => {
        if (entity.parentElement === gameArea) {
          entity.remove();
        }
      }, 1200);

      gameArea.appendChild(entity);
    }

    function startGame() {
      if (isPlaying) return;

      // âœ… Báº®T BUá»˜C NHáº¬P TÃŠN
      currentPlayerName = playerNameInput.value.trim();
      if (!currentPlayerName) {
        messageEl.textContent = "Nháº­p tÃªn Ä‘Ã£ rá»“i má»›i Ä‘Æ°á»£c chÆ¡i nha ğŸ“";
        return;
      }

      resetGame();
      isPlaying = true;
      startBtn.textContent = "Äang chÆ¡i...";

      gameInterval = setInterval(() => {
        timeLeft--;
        timeEl.textContent = timeLeft;

        if (timeLeft <= 0) {
          timeEl.textContent = 0;
          endGame();
        }
      }, 1000);

      spawnInterval = setInterval(() => {
        const amount = Math.random() < 0.4 ? 2 : 1;
        for (let i = 0; i < amount; i++) {
          spawnEntity();
        }
      }, 600);

      messageEl.textContent = "Nhanh tay click bÃ­ ngÃ´! TrÃ¡nh ma ra nhÃ©...";
    }

    startBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
